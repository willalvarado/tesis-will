<div class="estado-proyectos-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>ğŸ“Š Mis Proyectos</h1>
      <p>Monitorea el progreso de tus proyectos</p>
    </div>
    <div class="header-buttons">
      <button class="btn-nav" routerLink="/cliente/requerimientos">
        ğŸ“‹ Mis Requerimientos
      </button>
      <button class="btn-nav" routerLink="/cliente/bienvenida">
        ğŸ  Dashboard
      </button>
      <button class="btn-refresh" (click)="cargarProyectos()" [disabled]="cargando">
        ğŸ”„ {{ cargando ? 'Actualizando...' : 'Actualizar' }}
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-container" *ngIf="cargando && proyectos.length === 0">
    <div class="loader"></div>
    <p>Cargando proyectos...</p>
  </div>

  <!-- Projects Grid -->
  <div class="projects-grid" *ngIf="!cargando || proyectos.length > 0">
    <div class="project-card" *ngFor="let proyecto of proyectos" [class.selected]="proyectoSeleccionado?.id === proyecto.id">
      <!-- Project Header -->
      <div class="project-header">
        <div class="project-title">
          <h3>{{ proyecto.titulo }}</h3>
          <span class="status-badge" [style.background-color]="obtenerColorEstado(proyecto.estado)">
            {{ obtenerEtiquetaEstado(proyecto.estado) }}
          </span>
        </div>
        <div class="project-actions">
          <button class="btn-action btn-chat" [routerLink]="['/cliente/chat', proyecto.id]" title="Abrir Chat">ğŸ’¬</button>
        </div>
      </div>

      <!-- Project Info -->
      <div class="project-info">
        <p class="description">{{ proyecto.descripcion }}</p>
        
        <div class="info-grid">
          <div class="info-item">
            <span class="label">ğŸ‘¨â€ğŸ’» Vendedor:</span>
            <span class="value">{{ proyecto.vendedor?.nombre || 'Vendedor ' + proyecto.vendedor_id }}</span>
          </div>
          <div class="info-item">
            <span class="label">ğŸ“… Inicio:</span>
            <span class="value">{{ formatearFecha(proyecto.fechaInicio) }}</span>
          </div>
          <div class="info-item">
            <span class="label">â° Fecha de Entrega:</span>
            <span class="value">{{ formatearFecha(proyecto.fechaEstimada) }}</span>
          </div>
          <div class="info-item">
            <span class="label">ğŸ“ˆ Estado:</span>
            <span class="value" [style.color]="obtenerColorEstado(proyecto.estado)">
              {{ obtenerEtiquetaEstado(proyecto.estado) }}
            </span>
          </div>
        </div>

        <!-- Progress Bar - SOLO LECTURA -->
        <div class="progress-section">
          <div class="progress-header">
            <span class="progress-label">Progreso del Proyecto</span>
            <span class="progress-percentage">{{ proyecto.progreso }}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="proyecto.progreso" [style.background-color]="obtenerColorEstado(proyecto.estado)"></div>
          </div>
          <div class="progress-description">
            <span *ngIf="proyecto.progreso < 25" class="progress-text">ğŸš€ Iniciando proyecto</span>
            <span *ngIf="proyecto.progreso >= 25 && proyecto.progreso < 50" class="progress-text">âš¡ En desarrollo</span>
            <span *ngIf="proyecto.progreso >= 50 && proyecto.progreso < 75" class="progress-text">ğŸ”¨ Avances significativos</span>
            <span *ngIf="proyecto.progreso >= 75 && proyecto.progreso < 100" class="progress-text">ğŸ Casi terminado</span>
            <span *ngIf="proyecto.progreso === 100" class="progress-text">âœ… Completado</span>
          </div>
        </div>

        <!-- Budget Info - SOLO LECTURA -->
        <div class="budget-section">
          <div class="budget-item">
            <span class="label">ğŸ’° Presupuesto:</span>
            <span class="value">${{ proyecto.presupuesto }}</span>
          </div>
          <div class="budget-item">
            <span class="label">âœ… Pagado:</span>
            <span class="value">${{ proyecto.pagado }}</span>
          </div>
          <div class="budget-item">
            <span class="label">â³ Pendiente:</span>
            <span class="value pendiente">${{ proyecto.presupuesto - proyecto.pagado }}</span>
          </div>
        </div>

        

        

        <!-- Project Timeline -->
        <div class="timeline-section">
          <h4>ğŸ“… Cronograma</h4>
          <div class="timeline-item">
            <span class="timeline-date">{{ formatearFecha(proyecto.fechaInicio) }}</span>
            <span class="timeline-event">ğŸš€ Proyecto iniciado</span>
          </div>
          <div class="timeline-item">
            <span class="timeline-date">{{ formatearFecha(proyecto.fechaEstimada) }}</span>
            <span class="timeline-event">ğŸ¯ Entrega estimada</span>
          </div>
          <div class="timeline-item" *ngIf="proyecto.fechaCompletado">
            <span class="timeline-date">{{ formatearFecha(proyecto.fechaCompletado) }}</span>
            <span class="timeline-event">âœ… Proyecto completado</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="proyectos.length === 0 && !cargando">
      <div class="empty-icon">ğŸ“‹</div>
      <h3>No tienes proyectos activos</h3>
      <p>Cuando un vendedor acepte tus requerimientos aparecerÃ¡n aquÃ­</p>
      <button class="btn-primary" routerLink="/cliente/chat-asistente">Crear nuevo requerimiento</button>
    </div>
  </div>

  <!-- Chat Modal - CORREGIDO -->
  <div class="chat-overlay" *ngIf="mostrarChat" (click)="cerrarChatOverlay($event)">
    <div class="chat-modal">
      <div class="chat-header">
        <div class="chat-title">
          <div class="vendor-avatar">{{ proyectoSeleccionado?.vendedor?.avatar }}</div>
          <div class="chat-info">
            <h3>Chat con {{ proyectoSeleccionado?.vendedor?.nombre || 'Vendedor ' + proyectoSeleccionado?.vendedor_id }}</h3>
            <p>{{ proyectoSeleccionado?.titulo }}</p>
          </div>
        </div>
        <button class="btn-close" (click)="cerrarChat()">âœ•</button>
      </div>

      <div class="chat-messages">
        <div class="message" *ngFor="let mensaje of mensajes" [class.sent]="mensaje.remitente === 'cliente'" [class.received]="mensaje.remitente === 'vendedor'">
          <div class="message-content">
            <p>{{ mensaje.contenido }}</p>
            <div class="message-info">
              <span class="message-time">{{ formatearHora(mensaje.fecha) }}</span>
              <span class="message-status" *ngIf="mensaje.remitente === 'cliente'">{{ mensaje.leido ? 'âœ“âœ“' : 'âœ“' }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="chat-input" (click)="$event.stopPropagation()">
        <div class="input-wrapper">
          <input 
            #chatInput
            type="text" 
            [value]="nuevoMensaje"
            (input)="nuevoMensaje = $any($event.target).value"
            (keypress)="$event.key === 'Enter' && enviarMensaje()" 
            placeholder="Escribe tu mensaje..." 
            [disabled]="enviandoMensaje" 
            class="message-input"
            autocomplete="off"
          >
          <button class="btn-send" (click)="enviarMensaje()" [disabled]="enviandoMensaje || !nuevoMensaje.trim()">
            {{ enviandoMensaje ? 'â³' : 'ğŸ“¤' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>