<div class="requerimientos-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1>ğŸ“‹ Mis Requerimientos</h1>
      <p>Gestiona todos tus proyectos desde un solo lugar</p>
    </div>
    <div class="header-actions">
      <button class="btn-dashboard" (click)="irADashboard()">
        â† Atras
      </button>
      <button class="btn-refresh" (click)="cargarProyectos()" [disabled]="cargando">
        ğŸ”„ Actualizar
      </button>
      <button class="btn-nuevo" routerLink="/cliente/chat-asistente">
        â• Crear Proyecto
      </button>
      <button class="btn-standard btn-logout" (click)="cerrarSesion()">
        ğŸ”š Salir
  </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="cargando" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando proyectos...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error && !cargando" class="error-state">
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="cargarProyectos()">Reintentar</button>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!cargando && !error" class="proyectos-sections">

    <!-- ğŸ“¢ PUBLICADOS -->
    <section class="seccion" *ngIf="proyectosPublicados.length > 0">
      <div class="seccion-header">
        <h2>ğŸ“¢ Publicados</h2>
        <span class="badge">{{ proyectosPublicados.length }}</span>
      </div>
      <p class="seccion-descripcion">Esperando que vendedores acepten las sub-tareas</p>

      <div class="proyectos-grid">
        <div *ngFor="let proyecto of proyectosPublicados" class="proyecto-card publicado">
          <div class="card-header" (click)="toggleProyecto(proyecto)">
            <div class="card-title">
              <h3>{{ proyecto.titulo }}</h3>
              <span class="fase-badge" [style.background-color]="obtenerColorFase(proyecto.fase || '')">
                Publicado
              </span>
            </div>
            <span class="expand-icon" *ngIf="proyecto.total_subtareas">
              {{ proyecto.expandido ? 'â–¼' : 'â–¶' }}
            </span>
          </div>

          <div class="card-body">
            <p class="descripcion">{{ proyecto.descripcion }}</p>
            
            <div class="card-meta">
              <span class="meta-item">ğŸ“… {{ formatearFecha(proyecto.created_at) }}</span>
              <span class="meta-item" *ngIf="proyecto.total_subtareas">
                ğŸ”§ {{ proyecto.total_subtareas }} sub-tareas
              </span>
            </div>

            <div class="card-actions">
              <button class="btn-primary" (click)="verDetalleProyecto(proyecto)">
                ğŸ‘ï¸ Ver Detalle
              </button>
            </div>
          </div>

          <!-- Sub-tareas -->
          <div class="subtareas-container" *ngIf="proyecto.expandido && proyecto.subtareas">
            <div class="subtarea-item" *ngFor="let subtarea of proyecto.subtareas">
              <span class="subtarea-codigo">{{ subtarea.codigo }}</span>
              <span class="subtarea-titulo">{{ subtarea.titulo }}</span>
              <span class="subtarea-estado">{{ obtenerIconoEstado(subtarea.estado) }} {{ subtarea.estado }}</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- âš™ï¸ EN PROGRESO -->
    <section class="seccion" *ngIf="proyectosEnProgreso.length > 0">
      <div class="seccion-header">
        <h2>âš™ï¸ En Progreso</h2>
        <span class="badge">{{ proyectosEnProgreso.length }}</span>
      </div>
      <p class="seccion-descripcion">Proyectos con vendedores trabajando</p>

      <div class="proyectos-grid">
        <div *ngFor="let proyecto of proyectosEnProgreso" class="proyecto-card en-progreso">
          <div class="card-header" (click)="toggleProyecto(proyecto)">
            <div class="card-title">
              <h3>{{ proyecto.titulo }}</h3>
              <span class="fase-badge" [style.background-color]="obtenerColorFase(proyecto.fase || '')">
                En Progreso
              </span>
            </div>
            <span class="expand-icon" *ngIf="proyecto.total_subtareas">
              {{ proyecto.expandido ? 'â–¼' : 'â–¶' }}
            </span>
          </div>

          <div class="card-body">
            <p class="descripcion">{{ proyecto.descripcion }}</p>
            
            <!-- Progreso -->
            <div class="progress-section" *ngIf="proyecto.total_subtareas">
              <div class="progress-bar">
                <div class="progress-fill" 
                     [style.width.%]="(proyecto.subtareas_completadas || 0) / proyecto.total_subtareas * 100"
                     [style.background-color]="obtenerColorFase(proyecto.fase || '')">
                </div>
              </div>
              <span class="progress-text">
                {{ proyecto.subtareas_completadas || 0 }} / {{ proyecto.total_subtareas }} completadas
              </span>
            </div>

            <div class="card-meta">
              <span class="meta-item">ğŸ“… {{ formatearFecha(proyecto.fecha_inicio) }}</span>
              <span class="meta-item" *ngIf="proyecto.total_subtareas">
                ğŸ”§ {{ proyecto.total_subtareas }} sub-tareas
              </span>
            </div>

            <div class="card-actions">
              <button class="btn-primary" (click)="verDetalleProyecto(proyecto)">
                ğŸ‘ï¸ Ver Detalle
              </button>
            </div>
          </div>

          <!-- Sub-tareas con opciÃ³n de chat -->
          <div class="subtareas-container" *ngIf="proyecto.expandido && proyecto.subtareas">
            <div class="subtarea-item" 
                 *ngFor="let subtarea of proyecto.subtareas"
                 [class.clickable]="subtarea.vendedor_id"
                 (click)="verSubtarea(subtarea, $event)">
              <span class="subtarea-codigo">{{ subtarea.codigo }}</span>
              <span class="subtarea-titulo">{{ subtarea.titulo }}</span>
              <span class="subtarea-vendedor" *ngIf="subtarea.vendedor_nombre">
                ğŸ‘¤ {{ subtarea.vendedor_nombre }}
              </span>
              <span class="subtarea-estado">{{ obtenerIconoEstado(subtarea.estado) }} {{ subtarea.estado }}</span>
              <button class="btn-chat" *ngIf="subtarea.vendedor_id" (click)="verSubtarea(subtarea, $event)">
                ğŸ’¬
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- âœ… COMPLETADOS -->
    <section class="seccion" *ngIf="proyectosCompletados.length > 0">
      <div class="seccion-header">
        <h2>âœ… Completados</h2>
        <span class="badge">{{ proyectosCompletados.length }}</span>
      </div>
      <p class="seccion-descripcion">Proyectos finalizados exitosamente</p>

      <div class="proyectos-grid">
        <div *ngFor="let proyecto of proyectosCompletados" class="proyecto-card completado">
          <div class="card-header">
            <div class="card-title">
              <h3>{{ proyecto.titulo }}</h3>
              <span class="fase-badge" [style.background-color]="obtenerColorFase(proyecto.fase || '')">
                Completado
              </span>
            </div>
          </div>

          <div class="card-body">
            <p class="descripcion">{{ proyecto.descripcion }}</p>
            
            <div class="card-meta">
              <span class="meta-item">âœ… {{ formatearFecha(proyecto.fecha_completado) }}</span>
            </div>

            <div class="card-actions">
              <button class="btn-secondary" (click)="verDetalleProyecto(proyecto)">
                ğŸ‘ï¸ Ver Detalle
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Empty State -->
    <div *ngIf="proyectosPublicados.length === 0 && 
                proyectosEnProgreso.length === 0 && 
                proyectosCompletados.length === 0" 
         class="empty-state">
      <div class="empty-icon">ğŸ“‹</div>
      <h3>No tienes proyectos aÃºn</h3>
      <p>Comienza creando tu primer proyecto con nuestro asistente IA</p>
      <button class="btn-primary-large" routerLink="/cliente/chat-asistente">
        ğŸ’¬ Crear Nuevo Proyecto
      </button>
    </div>

  </div>
</div>