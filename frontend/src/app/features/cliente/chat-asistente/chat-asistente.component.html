<div class="chat-container">
  
<!-- Header -->
<div class="chat-header">
  <div class="assistant-info">
    <div class="avatar">ğŸ¤–</div>
    <div class="info">
      <h3>Analista de Proyectos con IA</h3>
      <p>
        <span *ngIf="!proyectoId">Iniciando anÃ¡lisis profundo...</span>
        <span *ngIf="proyectoId && !analisisCompletado">Proyecto {{proyectoId}} Â· AnÃ¡lisis en progreso</span>
        <span *ngIf="analisisCompletado">Proyecto {{proyectoId}} Â· AnÃ¡lisis completado</span>
      </p>
    </div>
  </div>
  
  <div class="header-actions">
    <button class="btn-header btn-requerimientos" (click)="irARequerimientos()">
      ğŸ“‹ Requerimientos
    </button>
    <button class="btn-header btn-dashboard" (click)="irADashboard()">
      ğŸ“Š Dashboard
    </button>
  </div>
</div>

  <!-- Chat Messages Area -->
  <div class="chat-messages" #chatMessages>
    
    <!-- Mensajes del chat -->
    <div 
      *ngFor="let mensaje of mensajes; let i = index" 
      [class.assistant-message]="mensaje.role === 'assistant'"
      [class.user-message]="mensaje.role === 'user'"
      class="message"
    >
      <!-- Mensaje del asistente -->
      <ng-container *ngIf="mensaje.role === 'assistant'">
        <div class="avatar">ğŸ¤–</div>
        <div class="message-content">
          <div *ngIf="!mensaje.mostrarLoader">
            <div [innerHTML]="formatearMensaje(mensaje.content)"></div>
            
            <div class="suggestions" *ngIf="i === 0">
              <div class="suggestion" (click)="usarSugerencia('Necesito una aplicaciÃ³n mÃ³vil para delivery')">
                ğŸ“± AplicaciÃ³n mÃ³vil de delivery
              </div>
              <div class="suggestion" (click)="usarSugerencia('Quiero crear una pÃ¡gina web para mi restaurante')">
                ğŸ½ï¸ PÃ¡gina web para restaurante
              </div>
              <div class="suggestion" (click)="usarSugerencia('Necesito un sistema de gestiÃ³n empresarial')">
                ğŸ“Š Sistema de gestiÃ³n empresarial
              </div>
              <div class="suggestion" (click)="usarSugerencia('Quiero desarrollar un e-commerce completo')">
                ğŸ›’ E-commerce completo
              </div>
            </div>
          </div>
          
          <div *ngIf="mensaje.mostrarLoader" class="processing-status">
            <div class="loader"></div>
            <span>Analizando con IA...</span>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="mensaje.role === 'user'">
        <div class="message-content">
          <p>{{ mensaje.content }}</p>
        </div>
        <div class="avatar user-avatar">ğŸ‘¤</div>
      </ng-container>
    </div>

    <div *ngIf="analisisCompletado && mostrarResumen" class="action-container">
      <div class="action-card">
        <div class="action-icon">ğŸš€</div>
        <div class="action-content">
          <h4>Listo para publicar</h4>
          <p>Tu proyecto estÃ¡ completamente analizado con {{ proyectoAnalizado?.subtareas?.length || 0 }} sub-tareas generadas.</p>
          <button 
            class="btn-publicar" 
            (click)="publicarProyecto()"
            [disabled]="enviando"
          >
            <span *ngIf="!enviando">Publicar Proyecto</span>
            <span *ngIf="enviando">Publicando...</span>
          </button>
          <button 
            class="btn-cancelar" 
            (click)="cancelar()"
            [disabled]="enviando"
          >
            Volver despuÃ©s
          </button>
        </div>
      </div>
    </div>

  </div>

  <!-- Chat Input -->
  <div class="chat-input-container">
    <div class="chat-status" *ngIf="proyectoId && !analisisCompletado">
      <span class="status-dot"></span>
      <span class="status-text">Chat activo Â· Sin lÃ­mite de preguntas</span>
    </div>

    <div class="chat-status completado" *ngIf="analisisCompletado">
      <span class="status-dot completado"></span>
      <span class="status-text">AnÃ¡lisis completado Â· Listo para publicar</span>
    </div>

    <div class="chat-form">
      <div class="input-group">
        <textarea 
          [(ngModel)]="mensajeUsuario"
          placeholder="Escribe tu respuesta o pregunta..."
          (keydown)="onEnterPress($event)"
          [disabled]="enviando || analisisCompletado"
          rows="1"
        ></textarea>
        <button 
          type="button"
          (click)="enviarMensaje()"
          [disabled]="!mensajeUsuario.trim() || enviando || analisisCompletado"
          class="send-button"
        >
          <span *ngIf="!enviando">ğŸ“¤</span>
          <span *ngIf="enviando" class="spinner">â³</span>
        </button>
      </div>
      
      <div class="input-hint" *ngIf="!analisisCompletado">
        <small>Presiona Enter para enviar Â· Shift+Enter para nueva lÃ­nea</small>
      </div>
    </div>
  </div>
</div>